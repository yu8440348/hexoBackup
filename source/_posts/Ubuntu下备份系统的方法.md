title: Ubuntu下备份系统的方法
tags:
  - Ubuntu
categories: []
date: 2015-01-07 15:08:00
---
## 备份Ubuntu系统的方法：

- 然后打开终端，输入以下命令：

- 成为根用户：
`sudo su`  
- 转到根目录：
`cd /`

- 然後，下面就是我用来备份我的系统的完整的命令：
```
tar -cvpzf /media/yuhaitao/文档1/backup.tgz --exclude=/proc --exclude=/lost+found --exclude=/mnt --exclude=/sys --exclude=/media --exclude=/home/yuhaitao --exclude=/boot /
```

接着，让我们稍微解释一下：
- tar 是用来备份的程序
- c - 新建一个备份文档
- v - 详细模式， tar程序将在屏幕上实时输出所有信息。
- p - 保存权限，并应用到所有文件。
- z - 采用‘gzip’压缩备份文件，以减小备份文件体积。
- f - 说明备份文件存放的路径， /media/sda7/backup.tgz 是本例子中备份文件名。这个备份文件备份的位置是其它分区，也就是原来的WIN分区中。因为我的根目录的空间不足，所以只有备份在其它的地方了。

> --excloude - 排除指定目录,使其不被备份

来看看我们想要包含的目录,我们不必备份所有的东西，因为有些目录是没有多大用处的。确认你不想包含的文件，否则您会得到一个很奇怪的结果。 您也不必备份 /mnt 目录下的东西，除非您有其他分区挂在它下面或者你坚持要备份。您还必须确保没有任何资源挂在 /media 目录下(比如，任何CD或者移动存储介质).否则，剔除/media。

最後一个参数是我们想要保存的目录. 我们想要保存所有的东西，使用 / 作为根目录。

我用这个办法进行备份的时候到了最后给我提示什么：tar:Error exit delayed from previous errors

当然，你的可能显示的是中文，反正就是说什么错误，上网查了查，说是权限不足造成的，但是如果你使用了Root权限还是这样的话，最好使用Live usb进行备份，因为有人说运行的时候备份就有可能这样。（有人说这个提示可以忽略）

用Live usb备份的办法：

然后打开终端，输入以下命令：

1、成为根用户：`sudo su`
2、转到根目录：`cd /`

3，创建目录：`mkdir /a`

4，挂在根目录分区 `mount /dev/sdax /a`

5，进入a目录 `cd /a`

6,备份 `tar -cvpzf /media/xxx/backup.tgz *`

 

然后就是将来还原Ubuntu系统备份了：

警告: 求您了，看在上帝的份上，千万小心这儿。如果您不明白您正在干什么，那很有可能复盖掉您重要的数据，所以请特别小心！

注意！！！因为 tar还原是只会覆盖相同的文件，但是这种方法只是恢复备份时的文件，就是说如果某些文件丢失或损坏了，这样可以恢复修复这些文件，但不能删除自备份到恢复前这期间所生成的其它文件，说白了就是假如你备份系统时有1234这四个文件，如果三天后，由于某些原因变成了1234'5（4改变了），你恢复后，就会变成12345，其中4'恢复成备份时的文件，5保留。所以大家要是想彻底还原成备份时候的样子最好彻底删除根目录下的所有文件，然后在还原，这样就可以还原成备份时的样子了。

好了，继续我们前面所讲的例子，我们在其它分区（sda7）目录下创建了一个名为backup.tgz的备份文件。

Linux 中美妙的事情之一就是在系统正在运行的情况下可以进行还原操作，而不需要启动光盘或者其他任何乱七八糟的东西。当然，如果您的系统已经崩溃，那您必须选择 使用live CD，但是结果还是一样。

好了，言归正传。这是我要用的命令，如果你的备份不是在和我一样的位置的位置的话，那请相应地修改/media/sda7这一点：

`tar -xvpzf /media/xxx/backup.tgz -C /`

如果您使用的是bz2压缩的：

`tar -xvpjf /media/xxx/backup.tar.bz2 -C /`

如果系统已经崩溃可以使用Live usb登录，然后
```
mkdir /tmp/root
mount /dev/sdaX /tmp/root
tar -xvpjf /media/xxx/backup.tar.bz2 -C /tmp/root
```
当然，恢复前可以先rm -rf /tmp/root/* 一下，这样就干干净净了。（就是之前说的删除根目录下的所有文件）

这个只是在本机上还原，如果是还原到别的机子上记得修改fstab文件。（可能还需要安装grub）

恢复命令结束时，你的工作还没完成，别忘了重新创建那些在备份时被排除在外的目录：
```
# mkdir proc
# mkdir lost+found
# mkdir mnt
# mkdir sys
# mkdir media
```
等等

这就是备份Linux系统的方法了，可能根本用不着系统的备份，不过有备无患，谁知道有没有需要还原的时候。